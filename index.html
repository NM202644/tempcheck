<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Temperature Check</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background-color: #f5f7fa;
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    h1 {
      margin-bottom: 16px;
      text-align: center;
    }
    .options {
      display: flex;
      justify-content: space-between;
      max-width: 700px;
      width: 100%;
      margin: 32px 0;
    }
    .option {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      font-size: 1.4rem;
      padding: 12px 16px;
      border-radius: 12px;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    .option:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }
    .label {
      font-size: 0.85rem;
      margin-top: 6px;
      color: #555;
    }
    .result {
      margin-top: 24px;
      padding: 16px 24px;
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
      font-size: 1.1rem;
      max-width: 400px;
    }
    .stats {
      margin-top: 16px;
      width: 100%;
      max-width: 500px;
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      font-size: 0.95rem;
    }
    .bar-container {
      width: 100%;
      height: 10px;
      background-color: #e0e0e0;
      border-radius: 5px;
      overflow: hidden;
      margin-top: 4px;
    }
    .bar {
      height: 100%;
      background-color: #2196f3;
      border-radius: 5px;
      transition: width 0.4s ease;
    }
    .reset-btn {
      margin-top: 16px;
      padding: 8px 16px;
      background-color: #bbdefb;
      color: #0d47a1;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.95rem;
    }
    .reset-btn:hover {
      background-color: #90caf9;
    }
  </style>
</head>
<body>
  <h1>How are you feeling?</h1>

  <div class="options">
    <div class="option" data-value="crisis" onclick="window.vote(this)">
      üö®<br><span class="label">Crisis</span>
    </div>
    <div class="option" data-value="highly-stressed" onclick="window.vote(this)">
      üò∞<br><span class="label">Highly Stressed</span>
    </div>
    <div class="option" data-value="concerned" onclick="window.vote(this)">
      üòü<br><span class="label">Concerned</span>
    </div>
    <div class="option" data-value="neutral" onclick="window.vote(this)">
      üòê<br><span class="label">Neutral</span>
    </div>
    <div class="option" data-value="very-good" onclick="window.vote(this)">
      üòä<br><span class="label">Very good</span>
    </div>
    <div class="option" data-value="thriving" onclick="window.vote(this)">
      üåü<br><span class="label">Thriving</span>
    </div>
  </div>

  <div class="result" id="result">
    Click an option above to record your temperature check.
  </div>

  <div class="stats" id="stats"></div>

  <button class="reset-btn" onclick="resetVotes()">
    Reset all votes
  </button>

  <script>
  const API_URL = "https://tempcheck-api.vercel.app";
  const keys = ["crisis", "highly-stressed", "concerned", "neutral", "very-good", "thriving"];
  const labels = {
    "crisis": "üö® Crisis",
    "highly-stressed": "üò∞ Highly Stressed",
    "concerned": "üòü Concerned",
    "neutral": "üòê Neutral",
    "very-good": "üòä Very good",
    "thriving": "üåü Thriving"
  };

  async function loadVotes() {
    try {
      const res = await fetch(`${API_URL}/results`);
      return await res.json();
    } catch(e) {
      console.error("API error:", e);
      return {};
    }
    }
  async function saveVote(value) {
  await fetch(`${API_URL}/vote`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ value })
  });
  }

let lastVotes = null;  // Cache for instant

async function updateStats() {
  try {
    const res = await fetch(`${API_URL}/results`);
    lastVotes = await res.json();
    renderStats(lastVotes);
  } catch(e) {
    if (lastVotes) renderStats(lastVotes);  // Use cached during lag
  }
}

function renderStats(votes) {
  const total = keys.reduce((sum, k) => sum + (votes[k] || 0), 0);
  const statsEl = document.getElementById("stats");
  statsEl.innerHTML = "";

  if (total === 0) {
    statsEl.innerHTML = "<p>No votes yet.</p>";
    return;
  }

  keys.forEach(k => {
    const count = votes[k] || 0;
    const pct = total > 0 ? (count / total * 100).toFixed(1) : 0;
    const barWidth = pct + "%";

    const row = document.createElement("div");
    row.className = "stat-row";
    row.innerHTML = `<span>${labels[k]}</span><span>${count} (${pct}%)</span>`;
    statsEl.appendChild(row);

    const barCont = document.createElement("div");
    barCont.className = "bar-container";
    const bar = document.createElement("div");
    bar.className = "bar";
    bar.style.width = barWidth;
    barCont.appendChild(bar);
    statsEl.appendChild(barCont);
  });
}

window.vote = async function(el) {
  const value = el.getAttribute("data-value");
  await saveVote(value);
  document.getElementById("result").innerHTML = `You voted: <strong>${labels[value]}</strong>`;
  
  // Instant optimistic bar
  if (lastVotes) {
    lastVotes[value] = (lastVotes[value] || 0) + 1;
    renderStats(lastVotes);
  }
  updateStats();  // Background sync
};

window.resetVotes = async function() {
  if (confirm("Reset all votes?")) {
    await fetch(`${API_URL}/reset`, {method: "POST"});
    document.getElementById("result").innerHTML = "‚úÖ All votes reset.";
    document.getElementById("stats").innerHTML = "<p>No votes yet.</p>";  // Instant disappear
    lastVotes = null;
    setTimeout(updateStats, 1000);  // Confirm server
  }
};

updateStats();
setInterval(updateStats, 4000);  // Gentle poll
</script>
</body>
</html>
